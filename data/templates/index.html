<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TARR Annunciator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #f0f0f0;
            padding: 20px;
        }
        h1 { text-align: center; }
        .section {
            background-color: #2a2a2a;
            padding: 20px;
            margin: 15px auto;
            border-radius: 8px;
            max-width: 600px;
        }
        label { display: block; margin: 10px 0 5px; }
        select, button { width: 100%; padding: 10px; margin-bottom: 10px; }
        button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        .status { text-align: center; margin-bottom: 20px; color: #4CAF50; }
    </style>
</head>
<body>
    <h1>TARR Annunciator Control</h1>
    
    <div class="status">
        <p>üéµ Audio System: Active | üïí Scheduler: Running | ‚öôÔ∏è <a href="/admin" style="color: #4CAF50;">üîí Admin Panel (Protected)</a> | üîó <a href="/api/docs" style="color: #4CAF50;">API Docs</a></p>
    </div>

    <!-- Announcement Control Buttons -->
    <div class="section" style="text-align: center; padding: 15px;">
        <h3>Announcement Controls</h3>
        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
            <button type="button" id="pause-announcements-btn" style="background-color: #ff9800;">‚è∏Ô∏è Pause Announcement Queue</button>
            <button type="button" id="resume-announcements-btn" style="background-color: #4CAF50;">‚ñ∂Ô∏è Resume All Announcements</button>
            <button type="button" id="stop-current-btn" style="background-color: #f44336;">‚èπÔ∏è Stop Current Announcement</button>
        </div>
        <div id="announcement-control-message" style="margin-top: 10px;"></div>
    </div>

    <!-- Station Announcement -->
    <div class="section">
        <h2>Station Announcement</h2>
        <form id="stationForm">
            <label for="train">Train Number:</label>
            <select name="train_number" id="train">
                {{range .trains}}
                    <option value="{{.ID}}">{{.Name}}</option>
                {{end}}
            </select>

            <label for="direction">Direction:</label>
            <select name="direction" id="direction">
                {{range .directions}}
                    <option value="{{.ID}}">{{.Name}}</option>
                {{end}}
            </select>

            <label for="destination">Destination:</label>
            <select name="destination" id="destination">
                {{range .destinations}}
                    <option value="{{.ID}}">{{.Name}}</option>
                {{end}}
            </select>

            <label for="track">Track Number:</label>
            <select name="track_number" id="track">
                {{range .tracks}}
                    <option value="{{.ID}}">{{.Name}}</option>
                {{end}}
            </select>

            <button type="submit">Play Station Announcement</button>
        </form>
    </div>

    <!-- Promo Announcement -->
    <div class="section">
        <h2>Promo Announcement</h2>
        <form id="promoForm">
            <label for="promo">Select Promo:</label>
            <select name="file" id="promo">
                {{range .promo_announcements}}
                    <option value="{{.ID}}">{{.Name}}</option>
                {{end}}
            </select>
            <button type="submit">Play Promo</button>
        </form>
    </div>

    <!-- Safety Announcement -->
    <div class="section">
        <h2>Safety Announcement</h2>
        <form id="safetyForm">
            <label for="language">Select Language:</label>
            <select name="language" id="language">
                {{range .safety_languages}}
                    <option value="{{.ID}}">{{.Name}}</option>
                {{end}}
            </select>
            <button type="submit">Play Safety Announcement</button>
        </form>
    </div>

    <script>
        async function postForm(formId, endpoint) {
            const form = document.getElementById(formId);
            const data = new FormData(form);
            try {
                const resp = await fetch(endpoint, {
                    method: 'POST',
                    body: data
                });
                const text = await resp.text();
                alert(text);
            } catch (err) {
                alert("Error: " + err);
            }
        }

        document.getElementById('stationForm').addEventListener('submit', e => {
            e.preventDefault();
            postForm('stationForm', '/play_announcement');
        });

        document.getElementById('promoForm').addEventListener('submit', e => {
            e.preventDefault();
            postForm('promoForm', '/play_promo');
        });

        document.getElementById('safetyForm').addEventListener('submit', e => {
            e.preventDefault();
            postForm('safetyForm', '/play_safety_announcement');
        });

        // Announcement control functions
        function showAnnouncementControlMessage(message, type = 'info') {
            const messageDiv = document.getElementById('announcement-control-message');
            const colorMap = {
                'success': '#4CAF50',
                'error': '#f44336',
                'warning': '#ff9800',
                'info': '#2196F3'
            };
            
            messageDiv.innerHTML = `<p style="color: ${colorMap[type]}; font-weight: bold; margin: 5px 0;">${message}</p>`;
            
            // Clear message after 5 seconds
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        async function pauseAnnouncements() {
            try {
                const resp = await fetch('/api/announcements/pause', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': 'tarr-api-2025'
                    }
                });
                const data = await resp.json();
                
                if (data.success) {
                    showAnnouncementControlMessage('All announcements paused', 'success');
                } else {
                    showAnnouncementControlMessage('Failed to pause announcements: ' + (data.error || 'Unknown error'), 'error');
                }
            } catch (err) {
                showAnnouncementControlMessage('Error pausing announcements: ' + err.message, 'error');
            }
        }

        async function resumeAnnouncements() {
            try {
                const resp = await fetch('/api/announcements/resume', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': 'tarr-api-2025'
                    }
                });
                const data = await resp.json();
                
                if (data.success) {
                    showAnnouncementControlMessage('All announcements resumed', 'success');
                } else {
                    showAnnouncementControlMessage('Failed to resume announcements: ' + (data.error || 'Unknown error'), 'error');
                }
            } catch (err) {
                showAnnouncementControlMessage('Error resuming announcements: ' + err.message, 'error');
            }
        }

        async function stopCurrentAnnouncement() {
            try {
                const resp = await fetch('/api/announcements/stop-current', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': 'tarr-api-2025'
                    }
                });
                const data = await resp.json();
                
                if (data.success) {
                    showAnnouncementControlMessage('Current announcement stopped', 'success');
                } else {
                    showAnnouncementControlMessage('Failed to stop current announcement: ' + (data.error || 'Unknown error'), 'error');
                }
            } catch (err) {
                showAnnouncementControlMessage('Error stopping announcement: ' + err.message, 'error');
            }
        }

        // Event listeners for announcement control buttons
        document.getElementById('pause-announcements-btn').addEventListener('click', pauseAnnouncements);
        document.getElementById('resume-announcements-btn').addEventListener('click', resumeAnnouncements);
        document.getElementById('stop-current-btn').addEventListener('click', stopCurrentAnnouncement);
    </script>
</body>
</html>